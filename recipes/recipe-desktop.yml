---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

# image will be published to ghcr.io/<user>/<name>
name: nsos-desktop
# description will be included in the image's metadata
description: "NSOS Custom Desktop Image (GNOME)"

# the base image to build on top of (FROM) and the version tag to use
base-image: quay.io/fedora-ostree-desktops/kinoite
image-version: 42

modules:
  - from-file: base.yml
  - from-file: module-recipes/default-flatpaks.yml
  # - from-file: module-recipes/gnome-extensions.yml

  - type: dnf
    install:
      packages:
        - solaar-udev
        - lm_sensors
    remove:
      packages:
        - firefox

  # Covering ublue-os/main here
  # Add negativo repo and replace some packages like HEIF & mesa
  - type: dnf
    repos:
      nonfree: negativo17
    # Replace Fedora packages with Negativos (Mesa & HEIF)  
    install:
      packages:
        - libopenjph # Manually install dependency for `libheif`, as Negativo upstreamed it
        - repo: fedora-multimedia
          packages:
            - libheif
    replace:
      - from-repo: fedora-multimedia
        packages:
          - libva
          - mesa-dri-drivers
          - mesa-filesystem
          - mesa-libEGL
          - mesa-libGL
          - mesa-libgbm
          - mesa-va-drivers
          - mesa-vulkan-drivers

  - type: script
    scripts:
      - udev/android.sh
      - udev/fancontrol.sh
      - ublue.sh
      - initramfs-zstd.sh

  - type: os-release
    properties:
      ID: nsos-desktop
      ID_LIKE: fedora
      NAME: NS-OS
      PRETTY_NAME: NS-OS Desktop GNOME

  - type: signing
